# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.
<% node['bind']['included_files'].each do |file| -%>
<% unless node['bind']['views'] && file == "#{node['bind']['sysconfdir']}/named.rfc1912.zones" -%>
include "<%= "#{file}" %>";
<% end -%>
<% end -%>

<% if !node['bind']['views'] -%>
<% @zones.uniq.each do |zone| -%>
<%
  if node['bind']['zones']['zones'].has_key?(zone)
    zone_name = node['bind']['zones']['zones'][zone]['domain']
    zone_file = zone
  else
    node['bind']['zones']['zones'].each do |k, v|
      if v['domain'] == zone
        zone_name = zone
        zone_file = k
        break
      end
    end
  end
-%>
<% if zone_name && zone_file -%>
<% zone_type = node['bind']['zones']['zones'][zone_file]['type'] -%>
zone "<%= zone_name %>" in {
  type <%= zone_type %>;
  file "<%= node['bind']['sysconfdir'] %>/<%= zone_type %>/<%= zone_file %>";
  <% if node['bind']['zones']['zones'][zone_file].has_key?('allow_transfer') && !node['bind']['zones']['zones'][zone_file]['allow_transfer'].empty? -%>
  allow-transfer {
    <% node['bind']['zones']['zones'][zone_file]['allow_transfer'].each do |at| -%> 
    <%= at %>;
    <% end -%>
  };
  <% else -%>
  allow-transfer { "none"; };
  <% end -%>
  <% if zone_type == "master" %> 
    <% if node['bind']['zones']['zones'][zone_file].has_key?('allow_update') && !node['bind']['zones']['zones'][zone_file]['allow_update'].empty? -%>
  allow-update {
      <% node['bind']['zones']['zones'][zone_file]['allow_update'].each do |au| -%> 
    <%= au %>;
      <% end -%>
  };
    <% else -%>
  allow-update { "none"; };
    <% end -%>
  <% else %>
  masters {
    <% node['bind']['zones']['zones'][zone_file]['masters'].each do |m| -%> 
    <%= m %>;
    <% end -%>
  };
  <% end %>
};
<% end %>

<% end -%>
zone "." IN {
  type hint;
  file "named.ca";
};
<% else -%>
include "<%= "#{node['bind']['views_file']}" %>";
<% end -%>
