# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.

<% @bind_acls.each do |acl| -%>
acl "<%= acl['id'] -%>" {
  <% acl['hosts'].each do |host| -%>
  <%= host -%>;
  <% end -%>
};

<% end -%>

<% if node['bind']['masters'] != [] -%>
masters default { <% node['bind']['masters'].each do |host| -%><%= host -%>; <% end -%> };
<% end -%>

options {
  directory "<%= node['bind']['sysconfdir'] %>";
  dump-file "<%= "#{node['bind']['vardir']}/data/cache_dump.db" %>";
  statistics-file "<%= "#{node['bind']['vardir']}/data/named_stats.txt" %>";
  memstatistics-file "<%= "#{node['bind']['vardir']}/data/named_mem_stats.txt" %>";
  <% if !node['bind']['views'] -%>
  <% if node['bind']['recursion'] -%>
  recursion yes;
  <% else -%>
  recursion no;
  <% end -%>
  <% if node['bind']['allow-query'] != nil -%>
  allow-query {
    <% node['bind']['allow-query'].each do |acl| -%>
    <%= acl%>;
    <% end -%>
  };
  <% end -%>
  <% if node['bind']['allow-query-cache'] != nil -%>
  allow-query-cache {
    <% node['bind']['allow-query-cache'].each do |acl| -%>
    <%= acl%>;
    <% end -%>
  };
  <% end -%>
  <% if node['bind']['allow-recursion'] != nil %>
  allow-recursion {
    <% node['bind']['allow-recursion'].each do |acl| -%>
    <%= acl%>;
    <% end -%>
  };
  <% end -%>
  <% if node['bind']['ipv6_listen'] -%>
  listen-on-v6 { any; };
  <% end -%>
  <% if node['bind']['allow-transfer'] != nil %>
  allow-transfer {
    <% node['bind']['allow-transfer'].each do |acl| -%>
    <%= acl%>;
    <% end -%>
  };
  <% end -%>
  <% if node['bind']['allow-notify'] != nil %>
  allow-notify {
    <% node['bind']['allow-notify'].each do |acl| -%>
    <%= acl%>;
    <% end -%>
  };
  <% end -%>
  <% if !node['bind']['listen-on'].empty? %>
  listen-on port <%= node['bind']['listen-on-port'] -%> {
  <% node['bind']['listen-on'].each do |addr| %>
      <%= addr %>;
  <% end %>
  };
  <% else %>
  listen-on { any; };
  <% end %>
  <% if !node['bind']['listen-on-v6'].empty? %>
  listen-on-v6 port <%= node['bind']['listen-on-v6-port'] -%> {
  <% node['bind']['listen-on-v6'].each do |addr| %>
      <%= addr %>;
  <% end %>
  };
  <% else %>
  listen-on-v6 { none; };
  <% end %>
  <% node['bind']['options'].each do |option_line| -%>
  <%= option_line %>
  <% end -%>
};

<% if node['bind']['enable_log'] %>
logging {
  channel b_query {
    file "<%= node['bind']['log_file'] %>" versions 2 size 1m;
    print-time yes;
    severity info;
    <% node['bind']['log_options'].each do |option_line| -%>
    <%= option_line %>
    <% end -%>
  };
  category queries { b_query; };
};
<% end %>

<% unless node['bind']['statistics-channel'] %> 
statistics-channels {
  inet * port <%= node['bind']['statistics-port'] -%>;
};
<% end %>
